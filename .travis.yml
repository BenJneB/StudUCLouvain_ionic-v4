env:
  global:
    - CC_TEST_REPORTER_ID=9e94eb42394f339fee6592314b209bd1afb92b11580fee8e550111aa42626990
    - ANDROID_API_LEVEL=28
    - ANDROID_BUILD_TOOLS_VERSION=28.0.3
    - ANDROID_ABI=armeabi-v7a

services:
  - xvfb

branches:
      only:
      - master

before_script:
      - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
      - chmod +x ./cc-test-reporter
      - ./cc-test-reporter before-build
      
before_install:
  - node --version
  - npm --version
  - gradle --version
install:
  - npm install
  - npm install -g ionic cordova
  
after_script:
  - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT

matrix:
    # app for browser (just for testing)
    - language: node_js
      node_js: "12.14.0"
      dist: xenial
      addons:
      chrome: stable
      jobs:
        include:
          - stage: "Tests"
            name: "Unit Tests"
            script: npm run test:onceAndCoverage
          - script: npm run e2e
            name: "E2E Tests"

    # app for android
    - language: android
      dist: trusty
      sudo: true
      android:
        components:
          - build-tools-28.0.3
          - android-28
      addons:
        apt:
          packages:
            - ant
            - oracle-java8-installer
            - oracle-java8-set-default
     # install:
        #- curl -sL https://deb.nodesource.com/setup_11.x | sudo -E bash -
        #- sudo apt-get install build-essential
      script:
        - sudo ionic cordova platform add android
        - sudo ionic cordova build --release --prod android
              
deploy:
  provider: pages
  skip-cleanup: true
  github-token: $GITHUB_TOKEN
  keep-history: true
  file_glob: true
  file: "/home/travis/build/BenJneB/StudUCLouvain_ionic-v4/platforms/android/app/build/outputs/apk/*/*.apk"
  on:
    repo: BenJneB/StudUCLouvain_ionic-v4
    branch: master
